<!DOCTYPE html>
<html lang="en">
{% include head.html %}
<body>

  <!-- Konten SPA -->
  <div id="page_holder">
    {{ content }} <!-- Konten homepage langsung muncul -->
  </div>

<script>
const pageHolder = document.getElementById('page_holder');
const base = "{{ site.baseurl }}"; // "/mouse"

// Fungsi load halaman via fetch
function loadPage(url) {
  fetch(url)
    .then(res => {
      if(!res.ok) throw new Error('Page not found: ' + url);
      return res.text();
    })
    .then(html => {
      html = html.replace(/<footer[\s\S]*?<\/footer>/gi,'');

      // Konten lama keluar
      const oldContent = pageHolder.querySelector('.page-content');
      if(oldContent) {
        oldContent.classList.add('out');
        setTimeout(() => oldContent.remove(), 400);
      }

      // Konten baru
      const wrapper = document.createElement('div');
      wrapper.className = 'page-content';
      wrapper.innerHTML = html;
      pageHolder.appendChild(wrapper);

      // Force reflow supaya transition jalan
      wrapper.getBoundingClientRect();

      wrapper.classList.add('active');

      window.scrollTo(0,0);
      attachLinkListeners();

    })
    .catch(err => {
      pageHolder.innerHTML = `<div style="padding:2em; background:#fee; color:#900;">
        <strong>Error loading page!</strong><br>${err.message}
      </div>`;
      console.error(err);
    });
}

// Pasang listener link internal
function attachLinkListeners() {
  document.querySelectorAll('a[href^="{{ site.baseurl }}/"]').forEach(a => {
    if(a.href.includes(window.location.origin)) {
      a.addEventListener('click', e => {
        e.preventDefault();
        let href = a.getAttribute('href');

        // Tambahkan index.html jika berakhiran /
        if(href.endsWith('/')) href += 'index.html';

        // Hitung hash bersih
        let relativePath = href.replace(base,'').replace(/^\/|\/index\.html$/g,'') || 'home';
        window.location.hash = relativePath;

        // Build fetch path
        let fetchPath = base + '/' + (relativePath === 'home' ? '' : relativePath + '/index.html');
        if(relativePath === 'home') {
          // homepage → pakai content langsung
          pageHolder.innerHTML = `{{ content | strip_newlines | jsonify | raw }}`;
          attachLinkListeners();
          window.scrollTo(0,0);
        } else {
          loadPage(fetchPath);
        }
      });
    }
  });
}

// Load halaman awal sesuai hash
function initPage() {
  let hash = window.location.hash.slice(1);

  if(!hash || hash === 'home') {
    // homepage → pakai content default
    pageHolder.innerHTML = `{{ content | strip_newlines | jsonify | raw }}`;
    attachLinkListeners();
    window.scrollTo(0,0);
    return;
  }

  // halaman lain → fetch
  let fetchPath = base + '/' + hash + '/index.html';
  loadPage(fetchPath);
}

window.addEventListener('hashchange', initPage);
window.addEventListener('DOMContentLoaded', initPage);
</script>

<footer class="site-footer">
  <p>&copy; 2025 Apip. All rights reserved.</p>
  <nav>
    <a href="{{ '/' | relative_url }}">Home</a> |
    <a href="{{ '/blog/' | relative_url }}">Blog</a> |
    <a href="{{ '/about/' | relative_url }}">About</a>
  </nav>
</footer>

</body>
</html>
