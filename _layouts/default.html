<!DOCTYPE html>
<html lang="en">
{% include head.html %}
<body>

  <!-- Konten AJAX -->
  <div id="page_holder"></div>

  <footer class="site-footer">
    <p>&copy; 2025 Apip. All rights reserved.</p>
    <nav>
      <a href="{{ '/' | relative_url }}">Home</a> |
      <a href="{{ '/blog/' | relative_url }}">Blog</a> |
      <a href="{{ '/about/' | relative_url }}">About</a>
    </nav>
  </footer>

<script>
const pageHolder = document.getElementById('page_holder');
const base = "{{ site.baseurl }}"; // "/mouse"

// ===== Load halaman via fetch =====
function loadPage(path) {
  fetch(path)
    .then(res => {
      if(!res.ok) throw new Error('Page not found');
      return res.text();
    })
    .then(html => {
      // Hapus footer jika ada di konten statis
      html = html.replace(/<footer[\s\S]*?<\/footer>/gi, '');

      pageHolder.style.opacity = 0;
      pageHolder.innerHTML = html;

      // Fade in sederhana
      let op = 0;
      const fadeIn = setInterval(() => {
        op += 0.1;
        pageHolder.style.opacity = op;
        if(op >= 1) clearInterval(fadeIn);
      }, 30);

      window.scrollTo(0,0);

      // Pasang listener ke semua link baru di konten
      attachLinkListeners();
    })
    .catch(err => {
      pageHolder.innerHTML = '<p>Page not found.</p>';
      console.error(err);
    });
}

// ===== Tangkap semua link internal =====
function attachLinkListeners() {
  document.querySelectorAll('a[href^="/"]').forEach(a => {
    if(a.href.includes(window.location.origin)) {
      a.onclick = e => {
        e.preventDefault();
        let href = a.getAttribute('href');

        // Hilangkan baseurl di awal jika ada
        if(href.startsWith(base)) href = href.slice(base.length);

        // Hilangkan slash di awal/akhir
        let relativePath = href.replace(/^\/|\/$/g,'') || 'home';

        // Update hash (hashchange listener akan loadPage)
        window.location.hash = relativePath;
      };
    }
  });
}

// ===== Handler hashchange =====
function handleHashChange() {
  let hash = window.location.hash.slice(1) || 'home';
  const fetchPath = base + '/' + (hash === 'home' ? 'index.html' : hash + '/index.html');
  loadPage(fetchPath);
}

// ===== Init =====
window.addEventListener('DOMContentLoaded', handleHashChange);
window.addEventListener('hashchange', handleHashChange);
</script>

</body>
</html>
