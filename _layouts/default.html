<!DOCTYPE html>
<html lang="en">
{% include head.html %}
<body>

  <!-- Konten SPA -->
  <div id="page_holder">
    {{ content }} <!-- Konten homepage langsung muncul -->
  </div>

<script>
const pageHolder = document.getElementById('page_holder');
const base = "{{ site.baseurl }}"; // "/mouse"

// Fungsi fade-in sederhana
function fadeIn(el) {
  let op = 0;
  const fade = setInterval(() => {
    op += 0.1;
    el.style.opacity = op;
    if(op >= 1) clearInterval(fade);
  }, 30);
}

// Fungsi load halaman via fetch
function loadPage(path, push = true) {
  fetch(path)
    .then(res => {
      if(!res.ok) throw new Error('Page not found: ' + path);
      return res.text();
    })
    .then(html => {
      html = html.replace(/<footer[\s\S]*?<\/footer>/gi,'');

      const wrapper = document.createElement('div');
      wrapper.className = 'page-content';
      wrapper.innerHTML = html;

      pageHolder.innerHTML = '';
      pageHolder.appendChild(wrapper);

      wrapper.getBoundingClientRect();
      wrapper.classList.add('active');

      window.scrollTo(0,0);
      attachLinkListeners();

      // update URL tanpa reload
      if(push) {
        let url = path.replace(base,'').replace(/\/index\.html$/,'');
        history.pushState({ path: url }, '', base + url);
      }

    })
    .catch(err => {
      pageHolder.innerHTML = `<div style="padding:2em; background:#fee; color:#900;">
        <strong>Error loading page!</strong><br>${err.message}
      </div>`;
      console.error(err);
    });
}

// Tangkap semua link internal
function attachLinkListeners() {
  document.querySelectorAll('a[href^="/"]').forEach(a => {
    if (!a.dataset.spaced && a.href.includes(window.location.origin)) {
      a.dataset.spaced = "true";
      a.addEventListener('click', e => {
        e.preventDefault();
        let url = a.getAttribute('href');

        // homepage special case
        if(url === base || url === base + '/') {
          loadPage(base + '/', true);
        } else {
          if(url.endsWith('/')) url += 'index.html';
          loadPage(url, true);
        }
      });
    }
  });
}

// Tangani back/forward browser
window.addEventListener('popstate', e => {
  if(e.state && e.state.path) {
    let path = base + e.state.path;
    // homepage special case
    if(path === base + '/') path = base + '/';
    loadPage(path, false);
  } else {
    loadPage(base + '/', false);
  }
});

// Load halaman awal
window.addEventListener('DOMContentLoaded', () => {
  attachLinkListeners();
  let path = location.pathname;
  if(path === base || path === base + '/') {
    loadPage(base + '/', false);
  } else {
    loadPage(path, false);
  }
});
</script>

<footer class="site-footer">
  <p>&copy; 2025 Apip. All rights reserved.</p>
  <nav>
    <a href="{{ '/' | relative_url }}">Home</a> |
    <a href="{{ '/blog/' | relative_url }}">Blog</a> |
    <a href="{{ '/about/' | relative_url }}">About</a>
  </nav>
</footer>

</body>
</html>
